---
import Course from '@layouts/Course.astro';
import { getCollection } from 'astro:content';
import { formatWeekString } from 'src/global';
import Gatekeeper from '@components/ShowForInstructor.tsx';
const weeklyResources = (await getCollection('weekly-resources', ({ id }) => /computer-science/.test(id)));
const weeklyEstimates = weeklyResources.map(({ data, id }) => ({
  date: id.slice(-10),
  minutes: data.resources.flatMap(resource => resource.time).reduce((a, b) => a + b, 0),
}));
const totalMinutes = weeklyEstimates.reduce((a, b) => a + b.minutes, 0);
---

<Course course="Computer Science" semester="Fall">
  <p>
    &larr; <a href="/2024/fall/computer-science">Course Homepage</a>
  </p>
  <h1>Instructor Page</h1>
  <p>Contains information that <strong>should only be viewed by the instructor</strong>.</p>
  <section>
    <Gatekeeper client:load>
      <div>
        <h2>Time Estimates</h2>
        <table>
          <thead>
            <tr>
              <th>Dates</th>
              <th>Time Estimate</th>
            </tr>
          </thead>
          <tbody>
            {
              weeklyEstimates.map(({ date, minutes }) => (
                <tr>
                  <td>{formatWeekString(date)}</td>
                  <td>
                    {minutes >= 60 ? <span>{Math.floor(minutes / 60)} hr</span> : ''}
                    <span>{minutes % 60} min</span>
                  </td>
                </tr>
              ))
            }
            <tr>
              <td>Cumulative</td>
              <td>{Math.floor(totalMinutes / 60)} hr {totalMinutes % 60} min</td>
            </tr>
          </tbody>
        </table>
      </div>
    </Gatekeeper>
  </section>
</Course>